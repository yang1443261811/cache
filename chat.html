<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<input type="text" id="message">
<button id="btn">send</button>
<script>

  var params = getQueryString('uid');
  console.log(params);
  var ws = new WebSocket("ws://localhost:9999");
  ws.onopen = function (e) {
    if (ws.readyState === 1) {
      ws.emit({type: 'bind', uid: params.uid});
    }
    console.log("握手成功");
  };
  ws.onmessage = function (e) {
    console.log("message:" + e.data);
  };

  ws.onerror = function () {
    console.log("error");
  };

  ws.emit = function (content) {
    ws.send(JSON.stringify(content));
  }

  document.querySelector('#btn').addEventListener('click', (e) => {
    var input = document.querySelector('#message');
    ws.emit({name: '杨', content: input.value, type: 'say', toUid: params.toUid});
  })

  function getQueryString(key) {
    var str = location.search;
    var queryString = str.substring(1, str.length);
    var arr = queryString.split('&');
    var obj = {};
    var i = 0;
    while (i < arr.length) {
      var temp = arr[i].split('=');
      obj[temp[0]] = temp[1];
      i++;
    }
    return obj;
  }
</script>
</body>
</html>